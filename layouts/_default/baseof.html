<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} · {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{ else }}{{ .Description }}{{ end }}">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  {{ range .AlternativeOutputFormats -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end -}}

  <script src="https://unpkg.com/@hotwired/turbo@7.3.0/dist/turbo.es2017-umd.js"></script>

  <script>
    document.addEventListener("turbo:load", function() {
      const themes = ['default', 'dark', 'sepia', 'terminal', 'ocean'];
      const toggleButton = document.getElementById('theme-toggle');
      if (!toggleButton) return;

      function setTheme(themeName) {
        document.body.classList.remove(...themes);
        if (themeName !== 'default') {
          document.body.classList.add(themeName);
        }
        localStorage.setItem('theme', themeName);
      }

      let savedTheme = localStorage.getItem('theme');
      if (!savedTheme) {
        savedTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'dark'
          : 'default';
      }
      setTheme(savedTheme);

      toggleButton.addEventListener('click', () => {
        let currentTheme = 'default';
        themes.forEach(t => {
          if (document.body.classList.contains(t)) currentTheme = t;
        });
        const nextTheme = themes[(themes.indexOf(currentTheme) + 1) % themes.length];
        setTheme(nextTheme);
      });
    });
  </script>
</head>

<body class="antialiased {{ if .IsHome }}home{{ end }}">

  <!-- ✅ THEME TOGGLE MOVED HERE -->
  <button id="theme-toggle" aria-label="Cycle Theme">
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shuffle-icon lucide-shuffle"><path d="m18 14 4 4-4 4"/><path d="m18 2 4 4-4 4"/><path d="M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22"/><path d="M2 6h1.972a4 4 0 0 1 3.6 2.2"/><path d="M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45"/></svg>
  </button>

  <div class="layout">

    <header class="header">
      <div class="logo" data-name="{{ .Site.Title }}">
        <a href="{{ .Site.BaseURL }}" class="logo-link" aria-label="{{ .Site.Title }}"></a>
      </div>
      <nav class="nav">
        <ul class="menu">
          {{ range .Site.Menus.main }}
            {{ $current := $.RelPermalink }}
            {{ $item := .URL | relURL }}
            <li class="{{ if or (eq $current $item) (and (ne $item "/") (hasPrefix $current $item)) }}active{{ end }}">
              <a href="{{ .URL | relURL }}">{{ .Name }}</a>
            </li>
          {{ end }}
        </ul>
      </nav>
    </header>

    <main class="content">
      <div class="page-identity">
         <a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a>
      </div>
      {{ block "main" . }}{{ end }}

      <footer class="footer">
        <span>© {{ now.Format "2006" }} {{ .Site.Title }}. All rights reserved.</span>
      </footer>
    </main>

  </div>
</body>
</html>
