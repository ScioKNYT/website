<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} · {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{ else }}{{ .Description }}{{ end }}">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  {{ range .AlternativeOutputFormats -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end -}}

  <script src="https://unpkg.com/@hotwired/turbo@7.3.0/dist/turbo.es2017-umd.js"></script>

  <script>
    document.addEventListener("turbo:load", function() {
      const themes = ['default', 'dark', 'sepia', 'terminal', 'ocean'];
      const toggleButton = document.getElementById('theme-toggle');
      if (!toggleButton) return;

      function setTheme(themeName) {
        document.body.classList.remove(...themes);
        if (themeName !== 'default') {
          document.body.classList.add(themeName);
        }
        localStorage.setItem('theme', themeName);
      }

      let savedTheme = localStorage.getItem('theme');
      if (!savedTheme) {
        savedTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'dark'
          : 'default';
      }
      setTheme(savedTheme);

      toggleButton.addEventListener('click', () => {
        let currentTheme = 'default';
        themes.forEach(t => {
          if (document.body.classList.contains(t)) currentTheme = t;
        });
        const nextTheme = themes[(themes.indexOf(currentTheme) + 1) % themes.length];
        setTheme(nextTheme);
      });
    });
  </script>
</head>

<body class="antialiased">

  <!-- ✅ THEME TOGGLE MOVED HERE -->
  <button id="theme-toggle" aria-label="Cycle Theme">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
         viewBox="0 0 24 24" fill="none" stroke="currentColor"
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="13.5" cy="6.5" r="2.5"></circle>
      <circle cx="17.5" cy="10.5" r="2.5"></circle>
      <circle cx="8.5" cy="7.5" r="2.5"></circle>
      <circle cx="6.5" cy="12.5" r="2.5"></circle>
      <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10
               c.926 0 1.648-.746 1.648-1.688
               0-.437-.18-.835-.437-1.125
               -.29-.289-.438-.652-.438-1.125
               a1.64 1.64 0 0 1 1.668-1.668h1.996
               c3.051 0 5.555-2.503 5.555-5.554
               C21.965 6.012 17.461 2 12 2z"></path>
    </svg>
  </button>

  <div class="layout">

    <header class="header">
      <div class="logo">
        <a href="{{ .Site.BaseURL }}">
          {{ if .Site.Params.logoImage }}
            <img src="{{ .Site.Params.logoImage | relURL }}"
                 alt="{{ .Site.Title }}"
                 class="logo-image logo-light">
          {{ end }}

          {{ if .Site.Params.logoImageDark }}
            <img src="{{ .Site.Params.logoImageDark | relURL }}"
                 alt="{{ .Site.Title }}"
                 class="logo-image logo-dark">
          {{ end }}

          <span class="logo-text">{{ .Site.Title }}</span>
        </a>
      </div>

      <nav class="nav">
        <ul class="menu">
          {{ range .Site.Menus.main }}
            {{ $current := $.RelPermalink }}
            {{ $item := .URL | relURL }}
            <li class="{{ if or (eq $current $item) (and (ne $item "/") (hasPrefix $current $item)) }}active{{ end }}">
              <a href="{{ .URL | relURL }}">{{ .Name }}</a>
            </li>
          {{ end }}
        </ul>
      </nav>
    </header>

    <main class="content">
      {{ block "main" . }}{{ end }}

      <footer class="footer">
        <span>© {{ now.Format "2006" }} {{ .Site.Title }}. All rights reserved.</span>
      </footer>
    </main>

  </div>
</body>
</html>
